[{"component":"Tag extraction (RuleSpec)","data_structure":"compiled patterns -> stored tag pack","design_rule":"Never parse oracle text at runtime; extract once per db snapshot.","expected_complexity":"O(#cards * #rules) once","notes":"Persist rule_ids + evidence spans for explainability.","snapshot_time_or_runtime":"SNAPSHOT"},{"component":"Primitive membership ops","data_structure":"bitset/int mask","design_rule":"Represent per-card primitives as bitsets.","expected_complexity":"O(#deck_cards * word_ops)","notes":"Fast popcount for density thresholds.","snapshot_time_or_runtime":"RUNTIME"},{"component":"Facet checks","data_structure":"int enums + small structs","design_rule":"Compile key facets into enums/packed ints; keep raw JSON for audit.","expected_complexity":"O(#facet_checks)","notes":"Avoid JSON parsing loops.","snapshot_time_or_runtime":"RUNTIME"},{"component":"Candidate retrieval","data_structure":"primitive_to_cards tables","design_rule":"Use inverted indices by primitive/role/equiv class.","expected_complexity":"O(intersections)","notes":"No full scans.","snapshot_time_or_runtime":"RUNTIME"},{"component":"Synergy edges","data_structure":"template joins","design_rule":"Use templates; compute only for commander + deck nodes and bounded candidates.","expected_complexity":"O(E) bounded","notes":"Hard cap nodes/edges.","snapshot_time_or_runtime":"RUNTIME"},{"component":"Caching","data_structure":"sqlite cache tables","design_rule":"Cache by (snapshot, ruleset, taxonomy, profile, bracket, deck_hash, commander_id).","expected_complexity":"O(1) lookup","notes":"Prevents recomputation in iterative refinement.","snapshot_time_or_runtime":"RUNTIME"}]